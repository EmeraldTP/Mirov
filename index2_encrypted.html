<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secured Document</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f2f5;
            margin: 0;
            color: #333;
        }
        .container {
            background: white;
            padding: 2.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        h2 { margin-top: 0; margin-bottom: 1rem; }
        p { margin-bottom: 1.5rem; color: #666; }
        input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 16px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        button:hover { background-color: #0056b3; }
        .error {
            color: #dc3545;
            margin-top: 15px;
            font-size: 14px;
            display: none;
            background-color: #ffe6e6;
            padding: 10px;
            border-radius: 4px;
        }
        .loading { display: none; margin-top: 10px; color: #007bff; }
    </style>
</head>
<body>
    <div class="container" id="login-box">
        <h2>Access Restricted</h2>
        <p>This document is encrypted. Enter password to access.</p>
        <input type="password" id="password" placeholder="Your password" autofocus>
        <button onclick="decryptContent()" id="btn-decrypt">Decrypt</button>
        <div class="loading" id="loading-msg">Decrypting...</div>
        <div class="error" id="error-msg">Invalid password or corrupted data.</div>
    </div>

    <script>
        const encryptedData = {
            salt: "kREroxSL5xXfspHSbCTI5Q==",
            iv: "Saxd1M+4X95XpEev",
            ciphertext: "g1kF6NEY275OBJc0z7cKmsGZ712kWkiwVavvazQD4cJ4bObJfxybEdmueJ7AUtCDZzdI6ti8S1RNfFsFJy8uk08RMBMBXdXHmZ1HXr4UJf2tShHpiXpDkOGMOV7mYtw8p8n1S9JwrPfpTPbZj92o7HSKX0uM0vu3kInw2dfEMD5ozJGYYPGg5TL2ySHTiuA4lkcZglri04eS199C7ZHgJUdV9RjK3faxN6Js68KuvduSr81GrWHFriqvojjdN76Gxelsf8ph9vGqDyoX+lRozDosddIR+irVG+bMQHCyuV1cRA0EjXaflnFT90s7BIfYL07OrPJpPs1FY5cHquItkbVtv3f4PnnVTawLp25Z/UkQ23ocdahEY/DMPBZdROlYRrJLSxmS8N34+v6rJDF9nk7yhLOm9ma4xqNu+Dd3baSdk7mnUGc43mI9U9kOVdWxs0o3O9oYlzLgl+vw0zoIX8zaHLOQbtcdhX0CQT7DNWUvhDnEpiE1M0Xamn6OlmZpm8+Ih+OT7swgknsBK0fnR8Tn86OH0dGoxMCOTfc+dAcWtiGNn4yQfcEoqL7u+NWNBKNp1audqEyLBsUYwLmn96kNUpirW1i7A3qZcmRlIHZK0jsyn7NAzFr+53lnzbEDfPwjS7PSAy3ZRw57Wv1Q8WIiTNpwNqLexo8y3vaYucOB6ZzjZghoX+VL0cq7T/3Ga2V6zX7AacD8551K+STE0kgAOj00qtWh0odKpL4gjG3SzX/opgyy48Xo2/Tjn/kHXWyKTj5+kyVofTU99qDiEi0RzEBtdMVj6ztAvOqvspFmV8qvbhfvyHXlYtgH0wy25UYTntfSbsQgGvxwWIt3TwrzTKI+AvVBLuGYMUTLaRzr1YEaYLdePp72iwhppyQyiDOxVvW66FxGc6mNHgZvuj5+SCMGygdtgDkcuCGCrImTWdst64BBl+IXrfCKl+0HFExbMPWx1NQykttUolglhW5mjoi2QSCu9RGu6h7n/SZIhpUKXIbaJLAT7Tnhtcb8f9NXXKTsHDsCOlps8wrXsCw2wgFoNGwb1L5jX+CgnU2xEs6yBM8k5oCLQJ4hKqV6sjcxmd4pFnL9IPPEzOklzzzd8FNlm8HzQ8DuxveVfBJpVmwn7mGMhkU6XqTh30Qj6H2ac+V8BGQCFXcOC14kvYVWz0upnXiMEfkgNmjSq2Wp4iBjgArn7HFK6J1b9IlWgAHG/UZErEdGk+r6lfGG3D5CsdXs7YOWfTgAop33XEPH3b80cQ5yojvtjuvbTMyIKbMOuU9R+gIRhs/WmJoj+Nil06S1m7z2+x+rYgYXWOCQqbZn7avv5aZrBhjWIX6baWTB5xbJyVjWrl/1MuIi09MKp1wPEVa19fWkRCejQNDOmX9xI4wJF9yVQ2ERGlgeujVU0xsJrS8rwwLF+ROMJ8HvUJeb719BbojN2SBZrkze75raA9VTAh7to+EPXqe2M0Do4AFhV+30txkstZuh/EmbzHf3maPAHlXmMaJZPccHrmFkfi4jJmol4ixMYRbaaXKVVecfxXr7j9AKUlXeu9I0lu8FQLKUXfT7Rod3bu+VOmdchMcmPSFo9+icXNBjW+sk27kGNAzRLpCo9WD4uK3P9vu4WIGJLMN08JLlKcKW0fS/9CxxynNYFTnGYi0U6tzKGL50xfUEL5dBkTI6PXILQO/XBoWEUkqyUA+OqR7cXNT9LN+drVRue/z0q1CzAACDv9XWZTXzSGMzl8GJrvzBNJqE1/GzgYkhBt6EjgK3IuIu5btOW7R27x4FhyGusPDqw6uyeBuI239g7xv3XdVO0XXc5uD+k3KbvAdoWoEe",
            iterations: 100000
        };

        // Auto-decrypt if password is in session storage
        window.addEventListener('DOMContentLoaded', () => {
            const savedPass = sessionStorage.getItem('decryption_pass');
            if (savedPass) {
                document.getElementById('login-box').style.opacity = '0.5';
                decryptContent(savedPass);
            }
        });

        async function decryptContent(providedPassword) {
            const passwordField = document.getElementById('password');
            const password = providedPassword || passwordField.value;
            const errorMsg = document.getElementById('error-msg');
            const loadingMsg = document.getElementById('loading-msg');
            const btn = document.getElementById('btn-decrypt');
            
            if (!password) return;

            if (!providedPassword) {
                errorMsg.style.display = 'none';
                loadingMsg.style.display = 'block';
                btn.disabled = true;
                passwordField.disabled = true;
            }

            try {
                const toUint8 = (str) => Uint8Array.from(atob(str), c => c.charCodeAt(0));
                
                const salt = toUint8(encryptedData.salt);
                const iv = toUint8(encryptedData.iv);
                const ciphertext = toUint8(encryptedData.ciphertext);

                const enc = new TextEncoder();
                const keyMaterial = await window.crypto.subtle.importKey(
                    "raw", 
                    enc.encode(password), 
                    { name: "PBKDF2" },
                    false, 
                    ["deriveKey"]
                );

                const key = await window.crypto.subtle.deriveKey(
                    {
                        name: "PBKDF2",
                        salt: salt,
                        iterations: encryptedData.iterations,
                        hash: "SHA-512"
                    },
                    keyMaterial,
                    { name: "AES-GCM", length: 256 },
                    true,
                    ["decrypt"]
                );

                const decryptedBuffer = await window.crypto.subtle.decrypt(
                    {
                        name: "AES-GCM",
                        iv: iv
                    },
                    key,
                    ciphertext
                );

                const dec = new TextDecoder();
                const decryptedHTML = dec.decode(decryptedBuffer);
                
                // Save password for seamless transition
                sessionStorage.setItem('decryption_pass', password);

                document.open();
                document.write(decryptedHTML);
                document.close();

            } catch (e) {
                console.error("Decryption failed:", e);
                
                if (providedPassword) {
                    sessionStorage.removeItem('decryption_pass');
                    document.getElementById('login-box').style.opacity = '1';
                    return;
                }

                errorMsg.style.display = 'block';
                loadingMsg.style.display = 'none';
                btn.disabled = false;
                passwordField.disabled = false;
                passwordField.focus();
            }
        }
        
        document.getElementById('password').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') decryptContent();
        });
    </script>
</body>
</html>